{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.local/microlearning/topic_record.schema.json",
  "title": "topic_record",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "topic_id",
    "source",
    "title",
    "url",
    "captured_at",
    "metrics"
  ],
  "properties": {
    "topic_id": {
      "type": "string",
      "description": "Stable id. Prefer sha1(subreddit + ':' + post_id)."
    },
    "source": {
      "type": "object",
      "additionalProperties": false,
      "required": ["provider", "subreddit"],
      "properties": {
        "provider": { "type": "string", "enum": ["reddit"] },
        "subreddit": { "type": "string" },
        "post_id": { "type": "string" },
        "post_permalink": { "type": "string" }
      }
    },
    "title": { "type": "string" },
    "url": { "type": "string" },
    "author": { "type": "string" },
    "created_at": { "type": "string", "description": "ISO-8601 timestamp if available." },
    "captured_at": { "type": "string", "description": "ISO-8601 timestamp when scraped." },
    "metrics": {
      "type": "object",
      "additionalProperties": false,
      "required": ["upvotes", "num_comments"],
      "properties": {
        "upvotes": { "type": "integer", "minimum": 0 },
        "num_comments": { "type": "integer", "minimum": 0 },
        "comment_velocity_per_hour": { "type": "number", "minimum": 0 },
        "upvote_velocity_per_hour": { "type": "number", "minimum": 0 }
      }
    },
    "keywords": {
      "type": "array",
      "items": { "type": "string" }
    },
    "entities": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Lightweight entity surface forms (companies, tools, conditions, etc.)."
    },
    "risk_flags": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "medical_claim",
          "finance_advice",
          "politics",
          "adult",
          "violence",
          "self_harm",
          "hate",
          "other"
        ]
      }
    },
    "microlearning_angle_candidates": {
      "type": "array",
      "items": { "type": "string" },
      "description": "1–3 candidate angles to teach something in 20–40 seconds."
    },
    "raw": {
      "type": "object",
      "description": "Optional raw provider payload fields for debugging."
    }
  }
}
