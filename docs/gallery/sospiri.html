<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgPHJlY3QgZmlsbD0iIzBhMGEwYSIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIi8+CiAgPHBhdGggZD0iTTggOCBMMjQgOCBMMjQgMjQgTDggMjQgWiBNMTIgMTIgTDIwIDEyIEwyMCAyMCBMMTIgMjAgWiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZTBlMGUwIiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8L3N2Zz4K"/>
<title>Sospiri</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;background:#080812;overflow:hidden}
canvas{display:block;width:100%;height:100%}
#info{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);color:rgba(255,255,255,0.9);background:rgba(0,0,0,0.6);padding:6px 12px;border-radius:6px;text-shadow:0 1px 3px rgba(0,0,0,0.9);font:13px/1.4 ui-monospace,monospace;pointer-events:none;text-align:center}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="info">Sospiri · concept: Petrarch · code: Quimbot</div>
<script>
const c=document.getElementById('c'),ctx=c.getContext('2d');
let W,H,px=null,py=null;
function resize(){W=c.width=innerWidth;H=c.height=innerHeight}
resize();
addEventListener('resize',resize);
addEventListener('mousemove',e=>{px=e.clientX;py=e.clientY});
addEventListener('mouseleave',()=>{px=py=null});
addEventListener('touchmove',e=>{px=e.touches[0].clientX;py=e.touches[0].clientY},{passive:true});
addEventListener('touchend',()=>{px=py=null});

function lerpColor(t){
  t=Math.max(0,Math.min(1,t));
  let r,g,b;
  if(t<0.25){const s=t/0.25;r=180-s*140;g=140-s*110;b=60+s*120}
  else if(t<0.6){const s=(t-0.25)/0.35;r=40+s*100;g=30-s*10;b=180+s*40}
  else{const s=(t-0.6)/0.4;r=140+s*100;g=20+s*130;b=220-s*40}
  return{r:Math.round(r),g:Math.round(g),b:Math.round(b)};
}

const maxP=220,particles=[];
let breathPhase=0;
const breathPeriod=6.0;

function spawn(){
  return{
    x:W/2+(Math.random()-0.5)*W*0.3,y:H+5,
    phaseOffset:Math.random()*Math.PI*2,
    drift:(Math.random()-0.5)*0.3,
    baseSpeed:0.15+Math.random()*0.25,
    ceiling:0.08+Math.random()*0.15,
    radius:1.2+Math.random()*2.5,
    age:0,
    waveAmp:8+Math.random()*20,
    waveFreq:0.5+Math.random()*1.5,
    maxAge:7+Math.random()*3
  };
}

let lastT=0;
function loop(t){
  if(!lastT)lastT=t;
  const dt=Math.min((t-lastT)/1000,0.05);
  lastT=t;

  breathPhase+=dt/breathPeriod*Math.PI*2;
  const breathMul=0.3+0.7*(0.5+0.5*Math.sin(breathPhase));

  const spawnCount=Math.floor((2+6*breathMul)*dt*60);
  for(let i=0;i<spawnCount&&particles.length<maxP;i++)particles.push(spawn());

  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.age+=dt;
    const hf=1-p.y/H;
    const cp=Math.max(0,hf/(1-p.ceiling));
    const af=1-cp*cp;
    p.y-=p.baseSpeed*breathMul*Math.max(0.02,af)*60*dt;
    p.x+=(Math.sin(p.age*p.waveFreq+p.phaseOffset)*p.waveAmp*0.02+p.drift)*dt*60;

    if(px!=null){
      const dx=px-p.x,dy=py-p.y,d=Math.hypot(dx,dy)||1;
      const pull=Math.min(1,120/d)*0.08;
      p.x+=dx*pull*dt;p.y+=dy*pull*dt;
    }

    let alpha=1;
    if(p.age<1)alpha*=p.age;
    if(cp>0.7)alpha*=1-(cp-0.7)/0.3;
    if(p.age>p.maxAge-2)alpha*=(p.maxAge-p.age)/2;

    if(p.age>p.maxAge||alpha<=0.01){particles.splice(i,1);continue}
    p._a=Math.max(0,Math.min(1,alpha));
    p._hf=hf;
  }

  ctx.clearRect(0,0,W,H);

  const bg=ctx.createLinearGradient(0,0,0,H);
  bg.addColorStop(0,'#080812');bg.addColorStop(0.7,'#0a0a18');bg.addColorStop(1,'#12100a');
  ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);

  const glow=ctx.createRadialGradient(W/2,H*1.05,0,W/2,H*1.05,H*0.6);
  glow.addColorStop(0,'rgba(160,120,50,0.08)');
  glow.addColorStop(0.5,'rgba(100,60,30,0.03)');
  glow.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle=glow;ctx.fillRect(0,0,W,H);

  particles.sort((a,b)=>b.radius-a.radius);
  for(const p of particles){
    const col=lerpColor(p._hf),a=p._a*0.75;
    const gr=p.radius*4;
    const gd=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,gr);
    gd.addColorStop(0,`rgba(${col.r},${col.g},${col.b},${a*0.5})`);
    gd.addColorStop(0.4,`rgba(${col.r},${col.g},${col.b},${a*0.15})`);
    gd.addColorStop(1,`rgba(${col.r},${col.g},${col.b},0)`);
    ctx.fillStyle=gd;ctx.beginPath();ctx.arc(p.x,p.y,gr,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=`rgba(${col.r},${col.g},${col.b},${a})`;
    ctx.beginPath();ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);ctx.fill();
  }
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
<script>(function(){var inFrame=false;try{inFrame=window.self!==window.top}catch(e){inFrame=true}if(inFrame)document.querySelectorAll("#info,.info,#ctrl,#buttons,#depth,.controls,#mode,button").forEach(function(e){e.style.display="none"})})()</script>
</body>
</html>
